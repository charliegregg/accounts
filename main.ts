namespace myTiles {
    //% blockIdentity=images._tile
    export const tile0 = img`
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
    `
    //% blockIdentity=images._tile
    export const tile1 = img`
        7 7 7 7 7 7 7 6 7 7 7 7 7 7 7 7
        6 7 7 7 7 7 7 7 7 7 7 6 7 7 7 7
        7 7 7 7 6 7 7 7 7 7 6 7 7 7 7 6
        7 7 7 7 7 6 7 7 7 7 7 7 7 7 6 7
        7 7 7 6 7 7 6 7 7 7 7 7 7 7 7 7
        7 7 6 7 7 7 7 7 7 7 6 7 7 7 7 7
        7 6 7 7 7 7 7 6 7 7 7 6 7 7 7 7
        7 7 7 7 7 7 7 7 6 7 7 7 6 7 7 6
        7 6 7 7 7 7 6 7 7 7 7 7 7 7 6 7
        7 7 6 7 7 6 7 7 6 7 6 7 7 7 7 7
        7 7 7 7 6 7 7 6 7 7 7 6 7 7 7 7
        7 6 7 7 7 7 6 7 7 7 7 7 7 7 6 7
        7 7 6 7 7 7 7 7 7 7 7 7 7 7 7 6
        6 7 7 7 7 7 6 7 7 7 7 6 7 7 7 7
        7 7 7 7 7 6 7 7 7 6 7 7 6 7 7 7
        7 7 7 7 7 7 7 7 6 7 7 7 7 7 7 7
    `
    //% blockIdentity=images._tile
    export const tile2 = img`
        7 7 7 7 7 7 7 6 7 7 7 7 7 7 7 7
        6 7 7 7 7 7 7 7 7 7 7 6 7 7 7 7
        7 7 7 7 7 4 4 4 4 4 4 7 7 7 7 6
        7 7 7 7 4 2 2 2 2 2 2 4 7 7 6 7
        7 7 7 4 f 4 2 2 2 2 2 2 e 7 7 7
        7 7 6 4 f 4 2 2 2 2 2 2 e 7 7 7
        7 6 7 4 f 4 2 2 2 2 2 2 e 7 7 7
        7 7 7 4 4 e e e e e e e e 7 7 6
        7 6 7 7 7 7 6 d b 7 7 7 7 7 6 7
        7 7 6 7 7 6 7 d b 7 6 7 7 7 7 7
        7 7 7 7 6 7 7 d b 7 7 6 7 7 7 7
        7 6 7 7 7 7 6 d b 7 7 7 7 7 6 7
        7 7 6 7 7 7 7 d b 7 7 7 7 7 7 6
        6 7 7 7 7 7 6 d b 7 7 6 7 7 7 7
        7 7 7 7 7 6 7 d b 6 7 7 6 7 7 7
        7 7 7 7 7 7 7 7 6 7 7 7 7 7 7 7
    `
    //% blockIdentity=images._tile
    export const tile3 = img`
        d d d d d d d b d d d d d d d d
        b d d d d d d d d d d b d d d d
        d d d d b d d d d d b d d d d b
        d d d d d b d d d d d d d d b d
        d d d b d d b d d d d d d d d d
        d d b d d d d d d d b d d d d d
        d b d d d d d b d d d b d d d d
        d d d d d d d d b d d d b d d b
        d b d d d d b d d d d d d d b d
        d d b d d b d d b d b d d d d d
        d d d d b d d b d d d b d d d d
        d b d d d d b d d d d d d d b d
        d d b d d d d d d d d d d d d b
        b d d d d d b d d d d b d d d d
        d d d d d b d d d b d d b d d d
        d d d d d d d d b d d d d d d d
    `
    //% blockIdentity=images._tile
    export const tile5 = img`
        7 7 7 7 7 7 7 6 7 7 7 7 7 7 7 7
        6 7 7 7 9 9 9 9 9 9 9 6 7 7 7 7
        7 7 7 9 5 5 5 5 5 5 5 9 7 7 7 6
        7 7 9 5 9 9 9 9 9 9 9 5 9 7 6 7
        7 9 5 9 9 5 5 5 5 5 9 9 5 9 7 7
        7 9 5 9 5 9 9 9 9 9 5 9 5 9 7 7
        7 9 5 9 5 9 5 5 5 9 5 9 5 9 7 7
        7 9 5 9 5 9 5 9 5 9 5 9 5 9 7 6
        7 9 5 9 5 9 5 5 5 9 5 9 5 9 6 7
        7 9 5 9 5 9 9 9 9 9 5 9 5 9 7 7
        7 9 5 9 9 5 5 5 5 5 9 9 5 9 7 7
        7 6 9 5 9 9 9 9 9 9 9 5 9 7 6 7
        7 7 6 9 5 5 5 5 5 5 5 9 7 7 7 6
        6 7 7 7 9 9 9 9 9 9 9 6 7 7 7 7
        7 7 7 7 7 6 7 7 7 6 7 7 6 7 7 7
        7 7 7 7 7 7 7 7 6 7 7 7 7 7 7 7
    `
}
controller.menu.onEvent(ControllerButtonEvent.Pressed, function () {
    if (Account != 0) {
        Account = 0
        tiles.setTilemap(tiles.createTilemap(
            hex`1000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`,
            img`
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
            `,
            [myTiles.tile0,myTiles.tile1,myTiles.tile2,myTiles.tile3,myTiles.tile5],
            TileScale.Sixteen
        ))
        game.splash("Signing Out...")
        Startup()
    }
})
function NewMailBox () {
    let MailBox: string[] = []
    MailBox.push(" ")
    Mail.push(MailBox)
}
function Prep () {
    let MailBox2: string[] = []
    tiles.setTilemap(tiles.createTilemap(
            hex`1000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`,
            img`
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
                . . . . . . . . . . . . . . . .
            `,
            [myTiles.tile0,myTiles.tile1,myTiles.tile2,myTiles.tile3,myTiles.tile5],
            TileScale.Sixteen
        ))
    for (let index = 0; index < RoomSize; index++) {
        for (let index = 0; index < RoomSize; index++) {
            Row.push(0)
        }
        Room.push(Row)
        Row = []
    }
    Room[0][0] = -1
    Room[0][2] = -2
    MailBox2.push(" ")
    Mail.push(MailBox2)
    Skin.push(0)
    Privacy.push(1)
    controller.moveSprite(mySprite, 100, 100)
}
function MakeRoom () {
    Row = []
    Room = []
    for (let index = 0; index < RoomSize; index++) {
        Row = []
        for (let index = 0; index < RoomSize; index++) {
            Row.push(0)
        }
        Room.push(Row)
    }
    Room[0][0] = -1
    Room[2][0] = 2
    Rooms.push(Room)
}
scene.onOverlapTile(SpriteKind.Player, myTiles.tile5, function (sprite, location) {
    if (game.ask("A > TELEPORT", "B > CLOSE")) {
        if (game.ask("A > USER ID", "B > USERNAME")) {
            TeleTo = game.askForNumber("What User ID?", 6)
        } else {
            EnteredTeleTo = game.askForString("What Username?", 12)
            for (let index7 = 0; index7 <= Logins.length / 4 - 1; index7++) {
                if (Logins[index7 * 4] == EnteredTeleTo) {
                    TeleTo = IDS[index7]
                }
            }
        }
        for (let index7 = 0; index7 <= Logins.length / 4 - 1; index7++) {
            if (IDS[index7] == TeleTo) {
                TeleTo = index7 + 1
            }
        }
        if (TeleTo > 0) {
            if (TeleTo == Account && RoomAt != Account) {
                game.splash("That's you!")
            } else if (RoomAt == TeleTo) {
                game.splash("You are already here!")
            } else if (game.ask("A > TELEPORT", "B > CANCEL")) {
                if (Privacy[TeleTo - 1] == 0) {
                    Show(TeleTo)
                    game.splash("WHOOOSH!")
                }
                else {
                    game.splash("Sorry this user has", "privacy on!")
                }

            }
            
            
        }
    }
})
function SignUp () {
    AccountCreate = true
    for (let index32 = 0; index32 <= Logins.length / 2 - 1; index32++) {
        if (Username == Logins[index32 * 2] && Password == Logins[index32 * 2 + 1]) {
            Account = index32 + 1
            game.splash("Account Recognised...", "Logging in...")
            AccountCreate = false
            Show(Account)
        } else if (Username == Logins[index32 * 2]) {
            game.splash("Username \"" + Username + "\" is taken!")
            if (game.ask("Try again?") == true) {
                Username = game.askForString("Username")
                AccountCreate = false
                SignUp()
            }
        }
    }
    if (AccountCreate == true) {
        Logins.push(Username)
        Logins.push(Password)
        Skin.push(0)
        Privacy.push(1)
        WrongID = true
        while (WrongID) {
            WrongID = false
            RandID = Math.randomRange(100000, 999999)
            for (let CheckingID = 0; CheckingID <= IDS.length - 1; CheckingID++) {
                if (IDS[CheckingID] == RandID) {
                    WrongID = true
                }
            }
        }
        IDS.push(RandID)
        NewMailBox()
        Account = Logins.length / 2
        game.splash("Account \"" + Username + "\" Created!", "Password: " + Password + " ID: " + RandID)
        MakeRoom()
        Show(Account)
    } else if (Account == 0) {
        Startup()
    }
}
function Show (Acc: number) {
    RoomAt = Acc
    if (Acc != 0) {
        Draw(Acc)
    }
}
function Settings (Num: number) {
    if (Num == 0) {
        if (game.ask("A > SWITCH PRIVACY", "B > NEXT") == true) {
            if (Privacy[Account - 1] == 0) {
                Privacy[Account - 1] = 1
            } else {
                Privacy[Account - 1] = 0
            }
            if (Privacy[Account - 1] == 0) {
                game.splash("Privacy is now", "OFF")
            } else {
                game.splash("Privacy is now", "ON")
            }
        } else {
            Settings(Num + 1)
        }
    } else if (Num == 1) {
        if (game.ask("A > SWITCH SKIN", "B > NEXT") == true) {
            if (Skin[Account - 1] == 0) {
                Skin[Account - 1] = 1
                mySprite.setImage(img`
                    . . . . . f f 4 4 f f . . . . .
                    . . . . f 5 4 5 5 4 5 f . . . .
                    . . . f e 4 5 5 5 5 4 e f . . .
                    . . f b 3 e 4 4 4 4 e 3 b f . .
                    . . f 3 3 3 3 3 3 3 3 3 3 f . .
                    . f 3 3 e b 3 e e 3 b e 3 3 f .
                    . f 3 3 f f e e e e f f 3 3 f .
                    . f b b f b f e e f b f b b f .
                    . f b b e 1 f 4 4 f 1 e b b f .
                    f f b b f 4 4 4 4 4 4 f b b f f
                    f b b f f f e e e e f f f b b f
                    . f e e f b d d d d b f e e f .
                    . . e 4 c d d d d d d c 4 e . .
                    . . e f b d b d b d b b f e . .
                    . . . f f 1 d 1 d 1 d f f . . .
                    . . . . . f f b b f f . . . . .
                `)
            } else {
                Skin[Account - 1] = 0
                mySprite.setImage(img`
                    . . . . . . f f f f . . . . . .
                    . . . . f f f 2 2 f f f . . . .
                    . . . f f f 2 2 2 2 f f f . . .
                    . . f f f e e e e e e f f f . .
                    . . f f e 2 2 2 2 2 2 e e f . .
                    . . f e 2 f f f f f f 2 e f . .
                    . . f f f f e e e e f f f f . .
                    . f f e f b f 4 4 f b f e f f .
                    . f e e 4 1 f d d f 1 4 e e f .
                    . . f e e d d d d d d e e f . .
                    . . . f e e 4 4 4 4 e e f . . .
                    . . e 4 f 2 2 2 2 2 2 f 4 e . .
                    . . 4 d f 2 2 2 2 2 2 f d 4 . .
                    . . 4 4 f 4 4 5 5 4 4 f 4 4 . .
                    . . . . . f f f f f f . . . . .
                    . . . . . f f . . f f . . . . .
                `)
            }
            if (Skin[Account - 1] == 0) {
                game.splash("Skin is now", "1")
            } else {
                game.splash("Skin is now", "2")
            }
        } else {
            Settings(Num + 1)
        }
    } else {
        Settings(0)
    }
}
function DrawTile (X: number, Y: number, Acc: number) {
    if (Rooms[Account - 1][X][Y] == 0) {
        tiles.setTileAt(tiles.getTileLocation(X, Y), myTiles.tile1)
        tiles.setWallAt(tiles.getTileLocation(X, Y), false)
    } else if (Rooms[Account - 1][X][Y] == 1) {
        tiles.setTileAt(tiles.getTileLocation(X, Y), myTiles.tile3)
        tiles.setWallAt(tiles.getTileLocation(X, Y), false)
    } else if (Rooms[Account - 1][X][Y] == -1) {
        tiles.setTileAt(tiles.getTileLocation(X, Y), myTiles.tile2)
        tiles.setWallAt(tiles.getTileLocation(X, Y), false)
    } else if (Rooms[Account - 1][X][Y] == 2) {
        tiles.setTileAt(tiles.getTileLocation(X, Y), myTiles.tile5)
        tiles.setWallAt(tiles.getTileLocation(X, Y), false)
    } else {
        tiles.setTileAt(tiles.getTileLocation(X, Y), myTiles.tile1)
        tiles.setWallAt(tiles.getTileLocation(X, Y), false)
    }
}
function Login () {
    AccountCreate = true
    for (let index22 = 0; index22 <= Logins.length / 2 - 1; index22++) {
        if (Username == Logins[index22 * 2] && Password == Logins[index22 * 2 + 1]) {
            Account = index22 + 1
            game.splash("Account Recognised...", "Logging in...")
            Show(Account)
            AccountCreate = false
        } else if (Username == Logins[index22 * 2]) {
            game.splash("Password Incorrect")
            if (game.ask("Try again?") == true) {
                Password = game.askForString("Password")
                Login()
            } else {
                Startup()
            }
        }
    }
    if (AccountCreate == true) {
        game.splash("Account not Recognised...")
        Startup()
    }
}
function Startup () {
    if (game.ask("A > LOGIN", "B > SIGNUP") == true) {
        Username = game.askForString("Username")
        Password = game.askForString("Password")
        Login()
    } else {
        Username = game.askForString("Username")
        Password = game.askForString("Password")
        SignUp()
    }
}
function WriteMail () {
    WritingMail = "" + WritingMail + game.askForString("Write Here", 24)
    if (game.ask("WriteMore?", "Yes > A  No > B")) {
        WriteMail()
    }
}
function Draw (Acc: number) {
    for (let RoomX = 0; RoomX <= RoomSize - 1; RoomX++) {
        for (let RoomY = 0; RoomY <= RoomSize - 1; RoomY++) {
            DrawTile(RoomX, RoomY, Acc)
        }
    }
    tiles.placeOnTile(mySprite, tiles.getTileLocation(1, 1))
}
scene.onOverlapTile(SpriteKind.Player, myTiles.tile2, function (sprite, location) {
    if (game.ask("A > MAIL", "B > INFO") == true) {
        if (game.ask("A > READ MAIL", "B > WRITE MAIL")) {
            ReadMail = []
            for (let index5 = 0; index5 <= Mail[Account - 1].length - 1; index5++) {
                if (Mail[Account - 1][index5] != " ") {
                    MailNum += 1
                    ReadMail.push(Mail[Account - 1][index5])
                    Mail[Account - 1][index5] = " "
                }
            }
            if (MailNum > 0) {
                if (game.ask("Read Mail?", "You have: " + MailNum / 4 + " New Mail!")) {
                    for (let index6 = 0; index6 <= MailNum / 4 - 1; index6++) {
                        game.splash(ReadMail[index6 * 4])
                        game.showLongText(ReadMail[index6 * 4 + 1], DialogLayout.Full)
                        game.splash(ReadMail[index6 * 4 + 2], ReadMail[index6 * 4 + 3])
                    }
                }
                MailNum = 0
            } else {
                game.splash("You Have no new mail.", "Come back later")
            }
        } else {
            if (game.ask("A > USER ID", "B > USERNAME")) {
                MailTo = game.askForNumber("What User ID?", 6)
            } else {
                EnteredMailTo = game.askForString("What Username?", 12)
                for (let index7 = 0; index7 <= Logins.length / 4 - 1; index7++) {
                    if (Logins[index7 * 4] == EnteredMailTo) {
                        MailTo = IDS[index7]
                    }
                }
            }
            Subject = game.askForString("Subject?", 24)
            WritingMail = ""
            WriteMail()
            if (game.ask("A > NORMAL", "B > ANONYMOUS") == true) {
                if (game.ask("A > PREVIEW", "B > SEND?")) {
                    game.splash(Subject)
                    game.showLongText(WritingMail, DialogLayout.Full)
                    game.splash("From: " + Logins[(Account - 1) * 2], "ID: " + IDS[Account - 1])
                    if (game.ask("A > SEND", "B > CANCEL")) {
                        Mail[MailTo].push(Subject)
                        Mail[MailTo].push(WritingMail)
                        Mail[MailTo].push("From: " + Logins[(Account - 1) * 2])
                        Mail[MailTo].push("ID: " + IDS[Account - 1])
                        game.splash("Sent!")
                    }
                } else {
                    if (game.ask("A > SEND", "B > CANCEL")) {
                        Mail[MailTo].push(Subject)
                        Mail[MailTo].push(WritingMail)
                        Mail[MailTo].push("From: " + Logins[(Account - 1) * 2])
                        Mail[MailTo].push("ID: " + IDS[Account - 1])
                        game.splash("Sent!")
                    }
                }
            } else {
                if (game.ask("A > PREVIEW", "B > SEND?")) {
                    game.splash(Subject)
                    game.showLongText(WritingMail, DialogLayout.Full)
                    game.splash("From: ???", "ID: ???")
                    if (game.ask("A > SEND", "B > CANCEL")) {
                        Mail[MailTo].push(Subject)
                        Mail[MailTo].push(WritingMail)
                        Mail[MailTo].push("From: ???")
                        Mail[MailTo].push("ID: ???")
                        game.splash("Sent Anonymously!")
                    }
                } else {
                    if (game.ask("A > SEND", "B > CANCEL")) {
                        Mail[MailTo].push(Subject)
                        Mail[MailTo].push(WritingMail)
                        Mail[MailTo].push("From: ???")
                        Mail[MailTo].push("ID: ???")
                        game.splash("Sent Anonymously!")
                    }
                }
            }
        }
    } else {
        if (game.ask("A > SETTINGS", "B > INFO") == false) {
            game.splash("ID: " + IDS[Account - 1].toString(), "USERNAME: " + Logins[2 * (Account - 1)])
        } else {
            Settings(0)
        }
    }
})
let Subject = ""
let EnteredMailTo = ""
let MailTo = 0
let MailNum = 0
let ReadMail: string[] = []
let WritingMail = ""
let RandID = 0
let WrongID = false
let Password = ""
let Username = ""
let AccountCreate = false
let EnteredTeleTo = ""
let TeleTo = 0
let Rooms: number[][][] = []
let Privacy: number[] = []
let Skin: number[] = []
let Room: number[][] = []
let Row: number[] = []
let Mail: string[][] = []
let RoomSize = 0
let Logins: string[] = []
let mySprite: Sprite = null
let IDS: number[] = []
let Account = 0
let RoomAt = 0
IDS = [Math.randomRange(100000, 999999)]
mySprite = sprites.create(img`
    . . . . . . f f f f . . . . . .
    . . . . f f f 2 2 f f f . . . .
    . . . f f f 2 2 2 2 f f f . . .
    . . f f f e e e e e e f f f . .
    . . f f e 2 2 2 2 2 2 e e f . .
    . . f e 2 f f f f f f 2 e f . .
    . . f f f f e e e e f f f f . .
    . f f e f b f 4 4 f b f e f f .
    . f e e 4 1 f d d f 1 4 e e f .
    . . f e e d d d d d d e e f . .
    . . . f e e 4 4 4 4 e e f . . .
    . . e 4 f 2 2 2 2 2 2 f 4 e . .
    . . 4 d f 2 2 2 2 2 2 f d 4 . .
    . . 4 4 f 4 4 5 5 4 4 f 4 4 . .
    . . . . . f f f f f f . . . . .
    . . . . . f f . . f f . . . . .
`, SpriteKind.Player)
scene.cameraFollowSprite(mySprite)
Logins = ["dev", "314"]
RoomSize = 16
Prep()
MakeRoom()
Startup()
